# 渔网分割功能流程

## 功能概述

渔网分割功能用于将大尺寸遥感影像按照规则网格划分为若干小块，便于后续处理和分析。本流程图描述了从用户导入影像到导出分割结果的完整操作流程。

## 完整操作流程图

```
┌───────────────┐
│  开始渔网分割  │
└───────┬───────┘
        ▼
┌───────────────┐
│  导入遥感影像  │
└───────┬───────┘
        ▼
┌───────────────┐     否     ┌───────────────┐
│  导入是否成功  ├────────────┤  显示错误信息  │
└───────┬───────┘            └───────────────┘
        │ 是
        ▼
┌───────────────┐
│  设置网格参数  │
└───────┬───────┘
        ▼
┌───────────────┐     否     ┌───────────────┐
│参数设置是否成功├────────────┤  显示错误信息  │
└───────┬───────┘            └───────────────┘
        │ 是
        ▼
┌───────────────┐
│  执行网格分割  │
└───────┬───────┘
        ▼
┌───────────────┐     否     ┌───────────────┐
│分割是否成功执行├────────────┤  显示错误信息  │
└───────┬───────┘            └───────────────┘
        │ 是
        ▼
┌───────────────┐
│  显示分割预览  │
└───────┬───────┘
        ▼
┌───────────────┐
│  导出分割结果  │
└───────┬───────┘
        ▼
┌───────────────┐     否     ┌───────────────┐
│导出是否成功完成├────────────┤  显示错误信息  │
└───────┬───────┘            └───────────────┘
        │ 是
        ▼
┌───────────────┐
│  分割流程结束  │
└───────────────┘
```

## 详细流程说明

### 1. 导入遥感影像

**操作步骤**：
1. 用户点击"导入影像"按钮
2. 系统弹出文件选择对话框
3. 用户选择遥感影像文件（支持.tif/.tiff/.img/.jpg/.png格式）
4. 系统尝试加载选中的影像文件

**可能的异常**：
- 文件格式不支持
- 影像文件损坏
- 影像文件过大，无法加载

**处理方式**：
- 显示错误信息
- 允许用户重新选择文件

### 2. 设置网格参数

**操作步骤**：
1. 用户点击"设置参数"按钮
2. 系统弹出参数设置对话框，显示当前图像尺寸
3. 用户输入网格行数和列数
4. 系统实时计算并显示每个网格的近似像素尺寸
5. 用户确认参数设置

**可能的异常**：
- 用户输入的参数无效（如负数或零）
- 计算出的网格过小或过大

**处理方式**：
- 限制输入范围（SpinBox的最小值为1）
- 显示警告信息
- 允许用户重新输入参数

### 3. 执行网格分割

**操作步骤**：
1. 用户点击"开始分割"按钮
2. 系统根据设置的参数执行分割操作
3. 系统生成分割示意图和分割结果

**算法流程**：
1. 计算每个网格的标准尺寸（原图宽度/列数，原图高度/行数）
2. 遍历每个行列位置，计算网格左上角坐标
3. 处理边界网格（可能宽高与标准尺寸不同）
4. 裁剪图像生成子图像
5. 保存网格位置和子图像信息

**可能的异常**：
- 内存不足
- 裁剪过程中出错

**处理方式**：
- 显示错误信息，提供详细错误原因
- 释放资源，允许用户重试或修改参数

### 4. 显示分割预览

**操作步骤**：
1. 系统自动显示分割示意图窗口
2. 用户可以点击"查看分割后图像"按钮查看详细结果
3. 用户可以在详细预览窗口中浏览所有分割后的图像，查看网格位置信息

**交互功能**：
- 图像适应窗口显示
- 支持鼠标滚轮缩放和平移
- 支持双击切换显示模式（适应窗口/原始大小）
- 通过上一个/下一个按钮浏览不同子图像

### 5. 导出分割结果

**操作步骤**：
1. 用户点击"导出结果"按钮
2. 系统弹出文件夹选择对话框
3. 用户选择保存结果的目录
4. 系统在选定目录下创建子文件夹结构
5. 系统导出所有分割后图像和分割示意图

**导出结构**：
```
选定目录/
  └── 原文件名_分割结果/
      ├── 网格图像/
      │   ├── 原文件名_1_1.png
      │   ├── 原文件名_1_2.png
      │   ├── ...
      │   └── 原文件名_行_列.png
      └── 原文件名_网格分割示意图.png
```

**可能的异常**：
- 磁盘空间不足
- 没有写入权限
- 文件路径过长

**处理方式**：
- 显示详细错误信息
- 允许用户选择其他保存位置

## 流程性能优化

1. **大型图像处理**:
   - 采用延迟加载技术，避免一次性加载整个图像到内存
   - 分块处理大型图像，降低内存占用

2. **UI响应性**:
   - 使用异步处理避免UI冻结
   - 提供处理进度反馈

3. **资源管理**:
   - 及时释放不再需要的资源
   - 控制同时打开的预览窗口数量

## 用户体验设计

1. **错误处理与提示**:
   - 提供明确的错误提示和解决建议
   - 对可恢复的错误提供重试选项

2. **操作引导**:
   - 按钮状态反映当前可执行的操作
   - 参数设置对话框提供实时反馈

3. **结果预览**:
   - 提供多种方式查看分割结果
   - 支持缩放和导航功能 