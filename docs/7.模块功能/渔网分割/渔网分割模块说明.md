# 渔网分割模块功能说明

## 模块概述

渔网分割模块用于将大型遥感影像按照网格方式划分为若干个小块，方便进行后续处理和分析。模块实现了影像导入、网格参数设置、分割处理、结果预览和导出等功能。

## 相关文件及功能

### 1. 模型层 - `Function/data/fishnet_seg.py`

该文件包含`FishnetSegmentation`类，是渔网分割的核心业务逻辑实现，遵循MVC模式中的Model层设计。

**主要功能**：
- 图像加载与处理
- 网格参数设置和验证
- 图像分割处理
- 结果导出
- 分割示意图生成

**核心方法**：
- `load_image()`: 加载遥感影像
- `set_grid_parameters()`: 设置网格参数
- `generate_grid()`: 执行网格分割处理
- `export_result()`: 导出分割结果到文件系统
- `create_overview_image_for_ui()`: 生成用于UI显示的网格示意图

### 2. 控制器 - `controller/event/fishnet_controller.py`

该文件包含`FishnetController`类，负责协调UI层与模型层的交互，处理用户操作，遵循MVC模式中的Controller层设计。

**主要功能**：
- 处理用户操作事件
- 调用模型层进行处理
- 更新UI显示结果
- 处理错误和异常情况

**核心方法**：
- `import_image()`: 处理用户导入图像操作
- `set_grid_params()`: 处理用户设置网格参数
- `start_fishnet()`: 执行分割并展示结果
- `show_preview()`: 显示分割结果预览
- `export_result()`: 处理导出分割结果

### 3. UI组件 - `ui/widgets/grid_dialogs.py`

该文件包含渔网分割相关的UI组件，如参数设置对话框、结果预览窗口等，遵循MVC模式中的View层设计。

**主要组件**：
- `GridParamsDialog`: 网格参数设置对话框
- `ImageViewer`: 图像查看控件，支持缩放和平移
- `GridOverviewWindow`: 渔网分割示意图窗口
- `GridPreviewWindow`: 分割图像浏览与导航窗口
- `GridImagesViewer`: 单个分割图像查看窗口

**特点**：
- 支持图像自适应显示，填充整个视图区域
- 支持鼠标滚轮缩放和双击切换查看模式
- 统一的UI样式和交互体验

### 4. 测试模块 - `test_fishnet.py`

该文件用于单独测试渔网分割功能，无需启动完整应用。

**主要功能**：
- 创建并初始化控制器和UI组件
- 连接信号和槽
- 启动测试界面

## 模块工作流程

1. **导入图像**：
   - 用户选择导入遥感影像
   - 控制器调用模型层加载图像
   - 控制器显示导入成功/失败消息

2. **设置网格参数**：
   - 用户点击设置网格参数按钮
   - 控制器创建并显示参数设置对话框
   - 用户输入网格行列数
   - 控制器调用模型层设置参数
   - 控制器显示参数设置结果

3. **执行分割**：
   - 用户点击开始分割按钮
   - 控制器调用模型层执行分割处理
   - 模型层返回分割结果
   - 控制器将结果转换为UI可用格式
   - 控制器创建并显示预览窗口

4. **导出结果**：
   - 用户点击导出结果按钮
   - 控制器让用户选择保存位置
   - 控制器调用模型层导出结果
   - 模型层将分割图像和示意图保存到指定位置
   - 控制器显示导出成功/失败消息

## 技术特点

1. **严格的MVC架构**:
   - 模型层（Model）: `fishnet_seg.py`
   - 视图层（View）: `grid_dialogs.py`
   - 控制器层（Controller）: `fishnet_controller.py`

2. **模块化设计**:
   - UI组件可以被复用于其他功能
   - 业务逻辑与界面完全分离

3. **用户体验优化**:
   - 图像自适应显示，充分利用显示区域
   - 缩放和导航功能，方便查看细节
   - 统一的UI风格和交互模式

4. **错误处理**:
   - 导入图像失败的处理
   - 分割异常的处理
   - 用户操作错误的提示 