# 渔网分割模块类图及关系说明

## 模块架构图

```
+-------------------+      +-------------------+      +-------------------+
|    FishnetPage    |----->| FishnetController |----->| FishnetSegmentation |
|    (View层)       |      |   (Controller层)  |      |     (Model层)     |
+-------------------+      +-------------------+      +-------------------+
        |                          |                          |
        |                          |                          |
        v                          v                          v
+-------------------+      +-------------------+      +-------------------+
|   UI交互界面组件   |      |    处理用户操作    |      |    核心算法实现    |
|   用户操作响应     |      |   调用模型层方法   |      |    数据处理逻辑    |
|   展示处理结果     |      |   更新UI显示内容   |      |    输出处理结果    |
+-------------------+      +-------------------+      +-------------------+
```

## 类关系详解

### 1. View层类

#### FishnetPage (ui/pages/fishnet_page.py)
- **功能**: 渔网分割功能的主界面
- **关系**: 接收用户操作，发送信号给控制器

#### 辅助UI类 (ui/widgets/grid_dialogs.py)
- **GridParamsDialog**
  - 网格参数设置对话框
  - 与FishnetController通信设置参数

- **ImageViewer**
  - 图像查看控件
  - 支持缩放、平移和自适应显示
  - 被其他UI组件复用

- **GridOverviewWindow**
  - 渔网分割示意图窗口
  - 显示带网格线的原始图像
  - 可以打开GridImagesViewer查看详细分割结果

- **GridPreviewWindow**
  - 分割预览窗口
  - 左侧显示分割示意图
  - 右侧显示当前选中的分割图像
  - 支持上一个/下一个导航

- **GridImagesViewer**
  - 分割图像浏览器
  - 支持在分割结果之间导航
  - 显示当前网格的行列位置信息

### 2. Controller层类

#### FishnetController (controller/event/fishnet_controller.py)
- **功能**: 处理用户操作，协调UI层和模型层交互
- **关系**:
  - 接收View层信号，调用Model层方法
  - 处理Model层返回结果，更新UI显示
  - 管理UI组件的创建和销毁
  - 处理异常情况和错误提示

### 3. Model层类

#### FishnetSegmentation (Function/data/fishnet_seg.py)
- **功能**: 实现渔网分割的核心算法和数据处理
- **关系**:
  - 不依赖UI层和控制器层
  - 提供纯粹的业务逻辑实现
  - 通过返回值与控制器通信

### 4. 测试模块

#### test_fishnet.py
- **功能**: 提供独立测试渔网分割功能的入口
- **关系**:
  - 创建FishnetController实例
  - 创建FishnetPage实例
  - 连接两者的信号关系
  - 提供独立运行环境

## 交互流程

1. **UI事件触发**:
   - 用户在FishnetPage界面操作按钮
   - FishnetPage发送信号给FishnetController

2. **控制器处理**:
   - FishnetController接收信号
   - 调用FishnetSegmentation的相应方法
   - 处理返回结果，决定后续流程

3. **模型层处理**:
   - FishnetSegmentation执行业务逻辑
   - 返回处理结果和状态给控制器

4. **更新UI**:
   - 控制器根据处理结果创建UI组件
   - 显示处理结果或错误信息
   - 更新UI状态

## 信号关系

```
FishnetPage.import_btn.clicked → FishnetController.import_image()
FishnetPage.param_btn.clicked → FishnetController.set_grid_params()
FishnetPage.fishnet_btn.clicked → FishnetController.start_fishnet()
FishnetPage.export_btn.clicked → FishnetController.export_result()
```

## 类设计优势

1. **高内聚，低耦合**:
   - 各层职责明确，相互独立
   - 通过明确的接口通信

2. **可扩展性**:
   - 可以轻松替换任何层的实现
   - 可以添加新的UI组件而不影响核心逻辑

3. **可测试性**:
   - 模型层可以独立测试
   - 控制器层可以通过模拟UI层信号测试
   - 提供独立的测试入口 